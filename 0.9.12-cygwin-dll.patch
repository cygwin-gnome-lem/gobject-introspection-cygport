--- origsrc/gobject-introspection-0.9.12/girepository/gitypelib.c	2010-09-16 10:01:34.000000000 -0500
+++ src/gobject-introspection-0.9.12/girepository/gitypelib.c	2010-11-04 16:12:47.663596400 -0500
@@ -2024,7 +2024,10 @@ _g_typelib_do_dlopen (GITypelib *typelib
               module = g_module_open (shlib_full->str, G_MODULE_BIND_LAZY);
               if (module == NULL)
                 {
-                  g_string_overwrite (shlib_full, strlen (shlib_full->str)-2, SHLIB_SUFFIX);
+                  g_string_overwrite (shlib_full, strlen (shlib_full->str)-strlen (SHLIB_SUFFIX), SHLIB_SUFFIX);
+#ifdef G_WITH_CYGWIN
+                  g_string_overwrite (shlib_full, 0, "cyg");
+#endif
                   module = g_module_open (shlib_full->str, G_MODULE_BIND_LAZY);
                 }
 
--- origsrc/gobject-introspection-0.9.12/giscanner/dumper.py	2010-10-04 15:31:35.000000000 -0500
+++ src/gobject-introspection-0.9.12/giscanner/dumper.py	2010-11-04 16:14:06.833734500 -0500
@@ -191,7 +191,7 @@ class DumpCompiler(object):
             args.append('--tag=CC')
             args.append('--silent')
 
-        args.extend([self._linker_cmd, '-o', output])
+        args.extend([self._linker_cmd, '-o', output + '.exe'])
         if libtool:
             args.append('-export-dynamic')
 
@@ -200,6 +200,9 @@ class DumpCompiler(object):
             for iflag in cflags.split():
                 args.append(iflag)
 
+        args.extend(list(sources))
+        args.append('-Wl,--export-all-symbols')
+
         # Make sure to list the library to be introspected first since it's
         # likely to be uninstalled yet and we want the uninstalled RPATHs have
         # priority (or we might run with installed library that is older)
@@ -225,7 +228,6 @@ class DumpCompiler(object):
             if not os.path.exists(source):
                 raise CompilerError(
                     "Could not find object file: %s" % (source, ))
-        args.extend(list(sources))
 
         if not self._options.quiet:
             print "g-ir-scanner: link: %s" % (
--- origsrc/gobject-introspection-0.9.12/giscanner/libtoolimporter.py	2010-10-06 09:15:41.000000000 -0500
+++ src/gobject-introspection-0.9.12/giscanner/libtoolimporter.py	2010-11-04 16:18:00.943342700 -0500
@@ -56,6 +56,8 @@ class LibtoolImporter(object):
             extension = '.dylib'
         elif platform_system == 'Windows':
             extension = '.dll'
+        elif sys.platform == 'cygwin':
+            extension = '.dll'
         else:
             extension = '.so'
 
--- origsrc/gobject-introspection-0.9.12/giscanner/shlibs.py	2010-06-10 12:54:54.000000000 -0500
+++ src/gobject-introspection-0.9.12/giscanner/shlibs.py	2010-11-04 16:19:05.106254500 -0500
@@ -47,7 +47,7 @@ def _resolve_libtool(options, binary, li
 # is crazy enough to name a library liblib<foo> when lib<foo> exists.
 #
 def _ldd_library_pattern(library_name):
-    return re.compile("(?<![A-Za-z0-9_-])(lib*%s[^A-Za-z0-9_-][^\s\(\)]*)"
+    return re.compile("(cyg%s-*[0-9]*\.dll)"
                       % re.escape(library_name))
 
 # This is a what we do for non-la files. We assume that we are on an
--- origsrc/gobject-introspection-0.9.12/giscanner/utils.py	2010-09-10 08:20:57.000000000 -0500
+++ src/gobject-introspection-0.9.12/giscanner/utils.py	2010-11-04 16:19:30.487498800 -0500
@@ -66,7 +66,7 @@ def to_underscores_noprefix(name):
     name = _upperstr_pat2.sub(r'\1_\2', name)
     return name
 
-_libtool_pat = re.compile("dlname='([A-z0-9\.\-\+]+)'\n")
+_libtool_pat = re.compile("dlname='([A-z0-9/\.\-\+]+)'\n")
 
 def _extract_dlname_field(la_file):
     f = open(la_file)
